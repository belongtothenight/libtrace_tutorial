# Setup Libtrace Development Environment

This directory only responsible for setting up and removing libtrace development environment and related code.

1. uthash
2. libwandder
3. wandio
4. libtrace
5. libtrace tutorial (forked, original can't be compiled)

You will be able to select different parts of the options listed in [./config.ini](./config.ini) file to install/re-install or remove after initial run is completed.

## Installation

To use this script, clone this repository, navigate to this directory, and run the setup script:

```bash
git clone https://github.com/belongtothenight/ACN_Code.git
cd ACN_Code/hw4_libtrace_setup
bash ./setup.sh
```

If you want to make sure things are running correctly, you can check the [Demo](#demo) section for the video links and log files, and [Debug](#debug) section for common issues and solutions.

## Tested Platforms

1. WSL2 Ubuntu 22.04 LTS
2. VM Ubuntu 23.10
3. Raspberry Pi 4 Ubuntu 24.04 LTS (by [@cnn1202](https://github.com/cnn1202))
        
## Commands

- Changes monitoring (see what is installed and where): 
    ```bash
    while true; do sleep 1; clear; echo -e "/usr/local/include"; ls /usr/local/include; echo -e "\n/usr/local/lib"; ls /usr/local/lib; echo -e "\n/opt"; ls /opt; done
    ```
- Install or Re-install: (change [./config.ini](./config.ini) before running)
    ```bash
    bash ./setup.sh
    ```
- Remove: (change [./config.ini](./config.ini) before running)
    ```bash
    bash ./remove.sh
    ```

## Demo

| Description          | URL                                                          | Install Log (slight changes)               |
| ---                  | ---                                                          | ---                                        |
| Platform 1 full demo | [https://youtu.be/eUz94aX3Fl8](https://youtu.be/eUz94aX3Fl8) | [./log/platform1.log](./log/platform1.log) |
| Platform 2 full demo | [https://youtu.be/4m0WfPn3zGw](https://youtu.be/4m0WfPn3zGw) | [./log/platform2.log](./log/platform2.log) |

## Debug

- wget and curl can't resolve host in WSL2 environment
    1. Edit `/etc/resolv.conf` as following:
        ```bash
        # This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
        # [network]
        # generateResolvConf = false
        nameserver 1.1.1.1
        ```
    2. Optional, edit `/etc/wsl.conf` to contain following network section:
        ```bash
        [network]
        generateResolveConf = false
        ```
- message similar to `error while loading shared libraries: libtrace.so.7: cannot open shared object file: No such file or directory`:<br>
    Execute the command below and try again:
    ```bash
    export LD_LIBRARY_PATH="/usr/local/lib"
    ```
- repo existed, symlink existed causing unable to create symlink error:<br>
    Try to remove installation and try again:
    ```bash
    bash ./remove.sh
    bash ./setup.sh
    ```
- C code related compiling warning/error:<br>
    First fix the error, adjust [./config.ini](./config.ini) to only run the error section, then try to partially re-compile:
    ```bash
    bash ./setup.sh
    ```
    or partially remove and re-install/compile:
    ```bash
    bash ./remove.sh
    bash ./setup.sh
    ```

## Structure

1. [./log/](./log/): Log directory.
2. [./.gitignore](./.gitignore): Git ignore file.
3. [./common_functions.sh](./common_functions.sh): Common bash functions used in setup and remove scripts.
4. [./config.ini](./config.ini): Configuration file.
5. [./readme.md](./readme.md): This file.
6. [./remove.sh](./remove.sh): Remove script. If error occurs, please find backup in `${program_install_dir}/backup*` and restore them.
7. [./setup.sh](./setup.sh): Setup script, for installing, configurating and compiling.

## Reference

| Package           | Type        | Version  | Link                                                                                                                         |
| -------           | :--:        | ---      | ----                                                                                                                         |
| uthash            | REPO        | latest   | [https://github.com/troydhanson/uthash](https://github.com/troydhanson/uthash)                                               |
| libwandder        | REPO        | 2.0.11-1 | [https://github.com/LibtraceTeam/libwandder](https://github.com/LibtraceTeam/libwandder)                                     |
| wandio            | REPO        | 4.2.6-1  | [https://github.com/LibtraceTeam/wandio](https://github.com/LibtraceTeam/wandio)                                             |
| wandio            | INSTALL     |          | [https://github.com/LibtraceTeam/wandio/blob/master/INSTALL](https://github.com/LibtraceTeam/wandio/blob/master/INSTALL)     |
| libtrace          | REPO        | 4.0.24-1 | [https://github.com/LibtraceTeam/libtrace](https://github.com/LibtraceTeam/libtrace)                                         |
| libtrace          | INSTALL     |          | [https://github.com/LibtraceTeam/libtrace/blob/master/INSTALL](https://github.com/LibtraceTeam/libtrace/blob/master/INSTALL) |
| libtrace_tutorial | REPO        | latest   | [https://github.com/ylai/libtrace_tutorial](https://github.com/ylai/libtrace_tutorial)                                       |
| libtrace_tutorial | FORKED REPO |          | [https://github.com/belongtothenight/libtrace_tutorial/](https://github.com/belongtothenight/libtrace_tutorial/)             |
